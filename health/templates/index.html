{% extends "base.html" %}
{% load static %}

{% block title %}
Home | Symptom Checker
{% endblock %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
{% endblock %}


{% block content %}
<section id="home" class="home-section">
    <div class="form-container">
        <input type="text" id="symptoms" placeholder="Enter your symptoms here">
        <button onclick="predictDisease()">Predict</button>
    </div>
</section>

<section id="features" class="features-section">
    {% if feature_infos %}
    <h2>{{feature_infos.first.title}}</h2>
    <div class="feature-buttons">
        {% for feature in feature_infos %}
        <button
            onclick="showFeature('{{feature.feature_button}}', '{{feature.content|default:','|escapejs}}')">{{feature.feature_button}}</button>
        {% endfor %}
    </div>
    {% else %}
    <p>No features found</p>
    {% endif %}
</section>

<section id="how-it-works" class="how-it-works">
    {% if working_infos %}
    <h2>{{working_infos.first.title}}</h2>
    <div class="steps">
        {% for working in working_infos %}
        <div class="step">
            <h3>{{working.steps}}</h3>
            <p>{{working.step_discription}}</p>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    <a href="#start-check" class="cta-button">Try It Free</a>
</section>

<div class="disclaimer">
    {% if disclaimer_infos %}
    <p><strong>Important Disclaimer:</strong>{{disclaimer_infos.first.important_disclaimer}}</p>
    {% endif %}
</div>

<footer id="contact">
    {% if disclaimer_infos %}
    <p>{{disclaimer_infos.first.footer}}</p>
    {% endif %}
</footer>

<div id="feature-popup" class="feature-popup">
    <p id="feature-text"></p>
    <button onclick="closePopup()">Close</button>
</div>

<div class="chat-icon" onclick="toggleChat()">
    <img src="data:image/jpeg;base64,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" alt="AI-chatbot" height="50px"
        style="overflow: hidden; border-radius: 100%;">
</div>
<div class="chat-box" id="chatBox">
    <div class="chat-header">
        <span>HealthBot</span>
        <button class="close-btn" onclick="toggleChat()">âœ–</button>
    </div>
    <div class="chat-body" id="chatBody"></div>
    <div class="chat-input-area">
        <input type="text" id="userInput" placeholder="Type your message...">
        <button onclick="sendMessage()">Send</button>
    </div>
</div>

<button class="toggle-mode" onclick="toggleMode()">Dark Mode</button>
{% endblock %}

{% block script %}
<script>
    function toggleMode() { document.body.classList.toggle('dark-mode'); }
    function predictDisease() { const s = document.getElementById('symptoms').value; if (s.trim() === '') { alert('Please enter your symptoms'); return; } alert('Prediction functionality is under development.'); }
    function showFeature(n, c) { const p = document.getElementById('feature-popup'); const t = document.getElementById('feature-text'); let m = ""; if (c && c.trim() !== '') { m = c + " feature is only for display, prediction not implemented yet."; } else { m = n + " feature is only for display, prediction not implemented yet."; } t.innerText = m; p.style.display = 'block'; setTimeout(() => { p.style.top = '20%'; }, 10); }
    function closePopup() { const p = document.getElementById('feature-popup'); p.style.top = '-50%'; setTimeout(() => { p.style.display = 'none'; }, 500); }
    function toggleChat() { const c = document.getElementById('chatBox'); c.style.display = c.style.display === 'flex' ? 'none' : 'flex'; }
   function sendMessage() {
  const input = document.getElementById('userInput');
  const chatBody = document.getElementById('chatBody');
  const userText = input.value.trim();

  if (!userText) return;

  // User message bubble
  const userMsg = document.createElement('div');
  userMsg.className = 'user-message';
  userMsg.textContent = 'You: ' + userText;
  chatBody.appendChild(userMsg);
  input.value = '';

  // Show loading message
  const botMsg = document.createElement('div');
  botMsg.className = 'bot-message';
  botMsg.innerHTML = 'Bot: <i>Thinking...</i>';
  chatBody.appendChild(botMsg);
  chatBody.scrollTop = chatBody.scrollHeight;

  // Send message to Django
  fetch('/health-chatbot/', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ message: userText })
  })
  .then(res => res.json())
  .then(data => {
    // Format the bot's reply (render HTML)
    botMsg.innerHTML = 'Bot: ' + data.reply;
    chatBody.scrollTop = chatBody.scrollHeight;
  })
  .catch(err => {
    botMsg.innerHTML = 'Bot: <b style="color:red;">Error occurred.</b>';
    console.error('Error:', err);
  });
}



</script>
{% endblock %}